import subprocess
import os.path
from os import path
import pdb
import shutil
import time
import copy


tag = 'tripletOnlyProxy2500' # FiltL, FiltH, FiltM, SingleCh
# tag = 'tripletOnlyLatents2500' # FiltL, FiltH, FiltM, SingleCh
# tag = 'mixerOnly' # FiltL, FiltH, FiltM, SingleCh
# tag = 'mixerHori' # FiltL, FiltH, FiltM, SingleCh
# model_lib = [1,10]#,16,165,89,186,3,11,23,150,142,2,148
# model_lib = [3,2,4]# FiltL
# model_lib = [99,113,20,123,122] #FiltH
# model_lib = [94,81,44,71,95,89,66,34,50] #latency
# model_lib = [137,150,135,123,107,108]
# model_lib = [131, 63, 52, 128] #only
# model_lib = [127,159,5,169,147] #hori
# model_lib = [222,258,196,246,235]# hori
# model_lib = [222,258,196,246,235]# hori
# model_lib = []
# model_lib = [193,275,333,254] # only
# model_lib = [286,302,303,278] # hori
# model_lib = [254, 275, 283, 319, 428, 437, 443, 504, 521] # only

# model_lib = [1022, 426,717,829,867,1033, 623, 946, 554, 1194] # latents
# model_lib = [926, 398, 597, 377, 438] # latentsTuned
# model_lib = [1383,1392,1417,1440,1450,1530,1550,1559,1594,1601,1624,1633,1723]
# model_lib = [0, 2, 4, 7, 8, 16, 18, 22, 26, 28, 29, 32, 33, 35, 38, 39, 44, 45, 50, 55, 58, 59, 62, 65, 66, 68, 70, 74, 87, 88, 100, 105, 106, 107, 109, 111, 116, 119, 120, 121, 123, 124, 126, 136, 137, 142, 145, 147, 149, 153, 154, 155, 164, 167, 168, 206, 207, 208, 209, 210, 216, 226, 231, 234, 238]
# model_lib = [268, 272, 276, 284, 286, 292, 299, 303, 305, 306, 315, 333, 334, 338]
# model_lib = [362, 364, 368, 370, 382, 384, 385, 386, 387, 388, 389, 397, 400, 401, 403, 404, 405, 407, 415, 416, 430]
# model_lib = [ 443, 455, 457, 460, 467, 468, 474, 476, 479, 482, 489, 494]
# model_lib = [498, 503, 504, 508]
# model_lib = [2, 7, 16, 22, 26, 28, 32, 35, 44, 50, 55, 59, 88, 106, 119, 120, 121, 123, 124, 126, 142, 145, 154, 168, 206, 207, 209, 213, 216, 222, 228, 253, 254, 268, 286, 292, 299, 305, 315, 364, 368, 370, 382, 384, 385, 386, 389, 400, 403, 405, 415, 416, 430, 443, 448, 455, 457, 460, 468, 471, 474, 476, 479, 482, 487, 489, 490, 494, 496, 498, 502, 503, 511, 528, 529, 534]
# model_lib = [ 668, 677, 678, 679, 680, 683, 684, 687, 690, 693, 695, 697, 701, 702, 707, 709]
# model_lib = [720, 724, 730, 732, 738, 739, 749, 753, 755, 760, 762, 778, 783, 784, 788, 791, 792, 799, 803, 808, 815, 820, 822]
# model_lib = [ 823, 824, 830, 835]
# model_lib = [853, 854, 868, 870, 871, 872, 873, 876, 878, 880, 883, 885, 886, 921, 923, 924, 925, 926, 927, 928, 929, 932, 934, 935, 937, 938, 940, 942, 943, 945, 946, 947, 949, 951, 955, 956, 957, 958, 964, 965, 966, 967, 968, 969, 970, 971, 974, 977, 978, 980, 991, 992, 995, 997, 998, 1001, 1003, 1005, 1007, 1010, 1014, 1029]

# model_lib = [1006, 1007, 1010, 1014, 1015, 1022, 1023, 1027, 1029, 1030, 1032, 1033, 1034, 1035, 1037, 1038, 1041, 1042, 1047, 1049, 1050, 1051, 1054, 1062]
# model_lib = [853, 854, 868, 869, 870, 871, 872, 873, 875, 876, 877, 878, 879, 880, 881, 882, 883, 884, 885, 886, 887, 921, 922, 923, 924, 925, 926, 927, 928, 929, 930, 931, 932, 933, 934, 935, 936, 937, 938, 939, 940, 941, 942, 943, 944, 945, 946, 947, 948, 949, 950, 951, 953, 954, 955, 956, 957, 958, 959, 964, 965, 966, 967, 968, 969, 970, 971, 974, 975, 976, 977, 978, 979, 980, 981, 982, 983, 988, 989, 991, 992, 995, 996, 997, 998, 1000, 1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, 1009, 1010, 1013, 1014, 1015, 1020, 1022, 1023, 1025, 1026, 1027, 1028, 1029, 1030, 1031, 1032, 1033, 1034, 1035, 1036, 1037, 1038, 1040, 1041, 1042, 1043, 1045, 1046, 1047, 1048, 1049, 1050, 1051, 1054, 1055, 1057, 1062, 1076, 1077, 1078, 1079, 1080, 1081, 1082, 1083, 1084, 1085, 1086, 1087, 1088, 1089, 1090, 1091, 1092, 1093, 1094, 1095, 1096, 1097, 1098, 1099, 1100, 1101, 1102, 1103, 1104, 1105, 1106, 1107, 1108, 1109, 1110, 1111, 1112, 1114, 1115, 1116, 1118, 1120, 1121, 1123, 1128, 1131]
# model_lib = [853, 854, 868, 869, 870, 871, 872, 873, 875, 876, 877, 878, 879, 880, 881, 882, 883, 884, 885, 886, 887, 921, 922, 923, 924, 925, 926, 927, 928, 929, 930, 931, 932, 933, 934, 935, 936, 937, 938, 939, 940, 941, 942, 943, 944, 945, 946, 947, 948, 949, 950, 951, 953, 954, 955, 956, 957, 958, 959, 964, 965, 966, 967, 968, 969, 970, 971, 974, 975, 976, 977, 978, 979, 980, 981, 982, 983, 988, 989, 991, 992, 995, 996, 997, 998, 1000, 1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, 1009, 1010, 1013, 1014, 1015, 1020, 1022, 1023, 1025, 1026, 1027, 1028, 1029, 1030, 1031, 1032, 1033, 1034, 1035, 1036, 1037, 1038, 1040, 1041, 1042, 1043, 1045, 1046, 1047, 1048, 1049, 1050, 1051, 1054, 1055, 1057, 1062, 1076, 1077, 1078, 1079, 1080, 1081, 1082, 1083, 1084, 1085, 1086, 1087, 1088, 1089, 1090, 1091, 1092, 1093, 1094, 1095, 1096, 1097, 1098, 1099, 1100, 1101, 1102, 1103, 1104, 1105, 1106, 1107, 1108, 1109, 1110, 1111, 1112, 1113, 1114, 1115, 1116, 1117, 1118, 1119, 1120, 1121, 1122, 1123, 1125, 1126, 1127, 1128, 1129, 1131, 1133, 1134, 1135, 1136, 1137, 1141, 1142, 1145, 1146, 1147, 1148, 1149, 1150, 1151, 1152, 1153, 1154, 1155, 1156, 1157, 1158, 1159, 1160, 1161, 1162, 1163, 1164, 1165, 1166, 1167, 1168, 1169, 1170, 1171, 1172, 1173, 1174, 1176, 1177, 1178, 1179, 1180, 1181, 1182, 1183, 1184, 1185, 1187, 1189, 1190, 1193, 1195, 1196, 1197, 1199, 1204, 1205, 1206, 1207, 1208, 1209, 1210, 1211, 1212, 
# model_lib = [1213, 1214, 1215, 1216, 1220, 1221, 1222, 1223, 1224, 1225, 1226, 1227, 1228, 1229, 1230, 1232]
# model_lib = [1234, 1235, 1236, 1237, 1238, 1239, 1240, 1241, 1242, 1243, 1244, 1245, 1246]
# model_lib = [1247, 1248, 1249, 1250, 1251, 1252, 1253, 1254, 1255, 1256, 1257, 1258, 1259, 1260, 1261, 1262, 1263, 1265, 1266, 1268, 1269, 1270, 1271, 1272, 1274, 1275, 1276, 1281]
# model_lib = [1282, 1284, 1286, 1289, 1290, 1291, 1292, 1294, 1295, 1296, 1297, 1298, 1301, 1302, 1305, 1310, 1312]
model_lib = [2288, 2294, 2299, 2302, 2310, 2312, 2315, 2319, 2320, 2322, 2325, 2326, 2329, 2334, 2337, 2343, 2345, 2348, 2350, 2351, 2354, 2355, 2356, 2368, 2375, 2397]
n = 0

for im, model in enumerate(model_lib):
    # subprocess.call(['python', 'pred.py', '--mode', 'export', '--model', model])

    for iv in [0]:#,1,2]:#range(3):#range(1,3):
        n+=1
        # print(n)
        # subprocess.call(['python', 'pred.py', '--mode', 'predict', '--model', model, '--val', str(iv)])
        # subprocess.call(['python', 'pred.py', '--mode', 'embedding', '--model', model, '--val', str(iv)])
        # subprocess.call(['python', 'pred.py', '--mode', 'export', '--model', model])
        # subprocess.call(['sbatch', 'cpu_batch_16GBXS.sh', model, str(iv)])
        model_name = 'Tune_'+'{0}_'.format(model)
        # print('submitting job for model: ', model_name, im, iv)
        # subprocess.call(['python', 'pred.py', '--mode', 'embedding', '--model', model_name, '--val', str(iv), '--tag', tag])
        pr_path = '/mnt/hpc/projects/OWVinckSWR/DL/predSWR/probs/'
        pr = 'preds_val{0}_{1}'.format(iv, model_name)
        

        files = [(pr in i) for i in os.listdir(pr_path)]
        if sum(files) == 0:
            print('submitting job for model: ', model_name, im, iv)
            subprocess.call(['python', 'pred.py', '--mode', 'predict', '--model', model_name, '--val', str(iv), '--tag', tag])
        else:
            print('model already predicted: ', model_name, im, iv)
        # subprocess.call(['python', 'pred.py', '--mode', 'export', '--model', model_name, '--val', str(iv), '--tag', tag])

        # subprocess.call(['sbatch', 'cpu_batch_16GBXS.sh', model_name, str(iv)])
    
        
        # # if not path.exists(pr):
        # #     print('submitting job for model: ', model, im, iv)
        #     subprocess.call(['sbatch', 'cpu_batch_16GBXS.sh', model, str(iv)])
        #     # subprocess.call(['sbatch', 'cpu_batch_16GBXS.sh', model, str(im)])
        #     # subprocess.call(['sbatch', 'cpu_batch_16GBXS.sh', model, str(im)])
        # else:
        #     print('model already predicted: ', model, im, iv)
        # # subprocess.call(['sbatch', 'cpu_batch_16GBXS.sh', model, str(im)])
        # # subprocess.call(['python', 'pred.py', '--mode', 'predictPlot', '--model', model])
        # # subprocess.call(['sbatch', 'gpu_batch_107inference.sh', model])


